<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>التصنيفات</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="store.css">
  <script>
    // دالة لاستخراج subdomain من الرابط/الدومين مع دعم safiastore.shop وبدائل عامة
    window.extractSubdomain = function() {
      try {
        const url = new URL(window.location.href);
        const qp = url.searchParams.get('subdomain');
        if (qp && qp.trim()) return qp.trim();

        const host = window.location.hostname;
        const parts = host.split('.');
        // قاعدة عامة: إزالة آخر جزئين (الدومين الأساسي والـ TLD)
        if (parts.length > 2) return parts.slice(0, -2).join('.');
        return 'default';
      } catch (_) {
        return 'default';
      }
    };

    // توافق مع دوال حالية إن وُجدت دون الكتابة فوقها
    if (typeof window.getCurrentSubdomain !== 'function') {
      window.getCurrentSubdomain = function() { return window.extractSubdomain(); };
    }

    // دالة مساعدة لجلب بيانات المتجر الأساسية حسب subdomain (stores, store_settings)
    window.fetchStoreContext = async function() {
      try {
        const subdomain = window.extractSubdomain();
        if (!window.supabase) {
          console.error('Supabase SDK غير محمّل بعد');
          return null;
        }

        const { data: store, error: storeError } = await window.supabase
          .from('stores')
          .select('id, name, subdomain, domain, is_active')
          .eq('subdomain', subdomain)
          .eq('is_active', true)
          .single();

        if (storeError || !store) {
          console.error('تعذّر العثور على المتجر لـ subdomain:', subdomain, storeError);
          return null;
        }

        const { data: settings } = await window.supabase
          .from('store_settings')
          .select('*')
          .eq('store_id', store.id)
          .single();

        return { store, settings };
      } catch (e) {
        console.error('خطأ أثناء جلب سياق المتجر:', e);
        return null;
      }
    };
  </script>
</head>
<body>
  
  <!-- مودل التحميل -->
  <div id="loading-modal" class="loading-modal">
    <div class="loading-content">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">جاري التحميل...</span>
      </div>
      <p class="mt-3 mb-0">جاري التحميل...</p>
    </div>
  </div>

  <!-- الشريط العلوي -->
  <div class="top-banner">
    التوصيل السريع خلال 24 ساعة و الدفع عند الاستلام
  </div>

  <!-- الهيدر الرئيسي -->
  <header class="main-header">
    <!-- الشعار -->
    <div class="logo-section">
      <img id="store-logo" src="https://cdn-icons-png.flaticon.com/512/263/263142.png" alt="شعار المتجر">
      <div class="logo-underline"></div>
    </div>
    
    <!-- روابط التنقل -->
    <nav class="nav-links">
      <a href="index.html" id="nav-home">الرئيسية</a>
      <a href="category.html" id="nav-category" class="active">التصنيفات</a>
      <a href="all-products.html" id="nav-products">كل المنتجات</a>
      <a href="about-us.html" id="nav-about">عن المتجر</a>
    </nav>

    <!-- زر القائمة للهواتف -->
    <button class="menu-btn" onclick="toggleSidebar()">
      <i class="bi bi-list"></i>
    </button>

    <!-- زر البحث للهواتف -->
    <button class="search-modal-btn" onclick="openSearchModal()">
      <i class="bi bi-search"></i>
    </button>
  </header>

  <!-- مودل البحث -->
  <div class="search-modal" id="search-modal">
    <div class="search-modal-content">
      <div class="search-modal-header">
        <h5>البحث عن المنتجات</h5>
        <button class="search-modal-close" onclick="closeSearchModal()">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>
      <input type="text" id="search-modal-input" class="search-modal-input" placeholder="اكتب اسم المنتج..." onkeyup="if(event.key === 'Enter') performModalSearch()">
      <button class="search-modal-btn-submit" onclick="performModalSearch()">
        <i class="bi bi-search"></i> بحث
      </button>
    </div>
  </div>

  <!-- القائمة الجانبية -->
  <div class="sidebar-overlay" onclick="closeSidebar()"></div>
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h5>القائمة</h5>
      <button class="sidebar-close" onclick="closeSidebar()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
    <ul class="sidebar-nav">
      <li><a href="index.html" id="sidebar-home"><i class="bi bi-house-door"></i> الرئيسية</a></li>
      <li><a href="category.html" id="sidebar-category" class="active"><i class="bi bi-grid"></i> التصنيفات</a></li>
      <li><a href="all-products.html" id="sidebar-products"><i class="bi bi-bag"></i> كل المنتجات</a></li>
      <li><a href="about-us.html" id="sidebar-about"><i class="bi bi-info-circle"></i> عن المتجر</a></li>
    </ul>
  </div>

  <main class="container py-5">
    <div class="section-heading-content text-center mb-5">
      <h1 class="section-title">
        تصنيفات المنتجات
      </h1>
      <p class="section-subtitle" style="color: #6c757d; font-size: 1.4rem; font-weight: 400; margin-top: 15px;">تصفح جميع تصنيفات المنتجات المتوفرة</p>
    </div>
    
    <div class="row g-4" id="categories-list">
      <!-- سيتم تعبئة التصنيفات ديناميكياً -->
    </div>
  </main>

  <footer class="main-footer p-3 mt-5"
          style="color: #000 !important; background: #fff; padding: 1rem 1.2rem; margin: 2rem 10px 0 10px; border-radius: 0 0 18px 18px; box-shadow: 0 2px 8px rgba(0,0,0,0.03); font-size: 1rem; text-align: center;">
    <div class="mt-2 text-center">
      جميع الحقوق محفوظة &copy; <span id="footer-store-name">متجري</span>
    </div>
    <!-- أيقونات وسائل التواصل الاجتماعي -->
    <div class="social-media-icons text-center mt-3" id="social-media-icons" style="display: none;">
      <a href="#" class="social-icon facebook-icon" target="_blank" rel="noopener noreferrer" style="display: none;">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/05/Facebook_Logo_%282019%29.png/1024px-Facebook_Logo_%282019%29.png" alt="Facebook" style="width: 25px; height: 25px; object-fit: contain;">
      </a>
      <a href="#" class="social-icon instagram-icon" target="_blank" rel="noopener noreferrer" style="display: none;">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e7/Instagram_logo_2016.svg/198px-Instagram_logo_2016.svg.png?20210403190622" alt="Instagram" style="width: 25px; height: 25px; object-fit: contain;">
      </a>
      <a href="#" class="social-icon whatsapp-icon" target="_blank" rel="noopener noreferrer" style="display: none;">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a7/2062095_application_chat_communication_logo_whatsapp_icon.svg/105px-2062095_application_chat_communication_logo_whatsapp_icon.svg.png?20220531073934" alt="WhatsApp" style="width: 25px; height: 25px; object-fit: contain;">
      </a>
      <a href="#" class="social-icon tiktok-icon" target="_blank" rel="noopener noreferrer" style="display: none;">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/34/Ionicons_logo-tiktok.svg/768px-Ionicons_logo-tiktok.svg.png" alt="TikTok" style="width: 25px; height: 25px; object-fit: contain;">
      </a>
    </div>
  </footer>
  
  <script>
    // فرض subdomain مبكراً قبل تحميل سكربتات الصفحات
    (function ensureSubdomainInUrl(){
      try {
        const params = new URLSearchParams(window.location.search);
        const hasParam = params.has('subdomain');
        var sub = 'default';
        try { if (typeof window.extractSubdomain === 'function') sub = window.extractSubdomain(); } catch(_) {}
        if (!hasParam && sub && sub !== 'default') {
          params.set('subdomain', sub);
          const newUrl = `${window.location.pathname}?${params.toString()}`;
          window.history.replaceState({}, '', newUrl);
        }
        if (sub && sub !== 'default') { try { localStorage.setItem('lastSubdomain', sub); } catch(_) {} }
      } catch(_) {}
    })();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src = "js/cumun.js" type="module">
     </script>
  <script>
    // دالة لتحديث جميع الروابط (بدون subdomain لأن Vercel rewrites يتعامل مع subdomains)
    function updateAllLinks() {
      // تحديث روابط التنقل الرئيسية
      const navLinks = [
        { id: 'nav-home', href: 'index.html' },
        { id: 'nav-category', href: 'category.html' },
        { id: 'nav-products', href: 'all-products.html' },
        { id: 'nav-about', href: 'about-us.html' }
      ];
      
      navLinks.forEach(link => {
        const element = document.getElementById(link.id);
        if (element) {
          element.href = link.href;
        }
      });
      
      // تحديث روابط السايد بار
      const sidebarLinks = [
        { id: 'sidebar-home', href: 'index.html' },
        { id: 'sidebar-category', href: 'category.html' },
        { id: 'sidebar-products', href: 'all-products.html' },
        { id: 'sidebar-about', href: 'about-us.html' }
      ];
      
      sidebarLinks.forEach(link => {
        const element = document.getElementById(link.id);
        if (element) {
          element.href = link.href;
        }
      });
    }
    
    // تشغيل الدالة عند تحميل الصفحة
    document.addEventListener('DOMContentLoaded', updateAllLinks);
  </script>
</body>
</html>

